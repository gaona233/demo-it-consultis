(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{7067:(e,t,l)=>{Promise.resolve().then(l.bind(l,9367))},9367:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>m});var a=l(5155);let n=l(5125).A.create({baseURL:"https://pokeapi.co/api/v2/"}),s=async e=>(await n.get("/pokemon?limit=".concat(24,"&offset=").concat(24*e))).data,r=async e=>(await n.get("/type/".concat(e))).data,c=async()=>(await n.get("/type")).data;var o=l(2115);function u(e){let{pokemons:t}=e;return(0,a.jsx)("section",{className:"grid grid-cols-6 gap-16",children:null==t?void 0:t.map(e=>(0,a.jsxs)("div",{className:"flex flex-col items-center justify-between",children:[(0,a.jsx)("h3",{children:e.name}),e.url?(0,a.jsx)("img",{width:"35",height:"53",className:"w-20",src:null==e?void 0:e.url,alt:e.name}):(0,a.jsx)("div",{className:"w-35 h-53"}),(0,a.jsxs)("p",{children:["Number: ",e.id]})]},e.name+e.id))})}let i=(0,o.memo)(e=>{var t;return(0,a.jsxs)("section",{className:"flex flex-wrap items-center gap-x-6 gap-y-3",children:[(0,a.jsx)("span",{children:"Types:"}),null==(t=e.types)?void 0:t.map(t=>{var l;return(0,a.jsx)("button",{className:"p-4 border ".concat((null==(l=e.selectedTypes)?void 0:l.includes(t))?"bg-blue-500 text-white":""),onClick:()=>{var l;return null==e||null==(l=e.clickType)?void 0:l.call(e,t)},children:t},t)})]})});var d=l(6671),p=l.n(d);function m(){let[e,t]=(0,o.useState)([]),[l,n]=(0,o.useState)([]),[d,m]=(0,o.useState)([]),[h,f]=(0,o.useState)({total:0,page:0}),[g,x]=(0,o.useState)([]),v=(0,o.useRef)(new Map),y=(0,o.useRef)(new Map);(0,o.useEffect)(()=>{c().then(e=>{if(null==e?void 0:e.results){var l;t(null==(l=e.results)?void 0:l.map(e=>e.name))}})},[]),(0,o.useEffect)(()=>{w()},[h.page]);let w=(0,o.useCallback)(async()=>{let e=await s(h.page);console.log(e);let t=(null==e?void 0:e.results)||[];x(null==t?void 0:t.map(e=>e.url)),m(null==t?void 0:t.map(e=>{var t;return{...e,url:"",id:null==(t=e.url.match(/pokemon\/(\d+)/))?void 0:t[1]}})),f({...h,total:e.count})},[h]),j=(0,o.useCallback)(e=>{let t=[...l],a=t.indexOf(e);a>-1?t.splice(a,1):t.unshift(e),n(t)},[e,l]),{items:k}=function(e){let{concurrentLimit:t=5}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},[l,a]=(0,o.useState)([]),[n,s]=(0,o.useState)(0),[r,c]=(0,o.useState)(!0),[u,i]=(0,o.useState)(null);return(0,o.useEffect)(()=>{if((null==e?void 0:e.length)==0)return;let l=!0,n=new Set;return(async()=>{try{c(!0);let r=[...e],o=Array(e.length).fill(null);for(;r.length>0&&l;){let c=r.splice(0,t).map(async(t,n)=>{let r=e.indexOf(t);try{let e=await fetch(t);if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=await e.json();l&&(o[r]={data:n,error:null},a(e=>{let t=[...e];return t[r]=n,t.filter(e=>null!=e)}),s(e=>e+1))}catch(e){l&&(o[r]={data:null,error:e.message},s(e=>e+1))}});n.add(Promise.allSettled(c))}await Promise.all([...n])}catch(e){i(e.message)}finally{l&&c(!1)}})(),()=>{l=!1}},[e,t]),{items:l,isLoading:r,progress:e.length>0?Math.round(n/e.length*100):0,error:u,completedCount:n,totalCount:e.length}}(g,{concurrentLimit:5});(0,o.useEffect)(()=>{k.forEach(e=>{var t,l;v.current.set(e.name,{name:e.name,url:null==e||null==(l=e.sprites.other)||null==(t=l.showdown)?void 0:t.front_default,id:null==e?void 0:e.id})})},[k]),(0,o.useEffect)(()=>{0!=l.length&&(async()=>{await b();let e=[];for(let t=0;t<l.length;t++){let a=y.current.get(l[t]);e.push(a)}let t=p().intersectionBy(...e,"name");console.log("data",t);let a=t.splice(0,24);x(null==a?void 0:a.map(e=>e.url)),m(null==a?void 0:a.map(e=>{var t;return{name:e.name,url:"",id:null==(t=e.url.match(/pokemon\/(\d+)/))?void 0:t[1]}})),f({page:0,total:t.length})})()},[l]);let b=(0,o.useCallback)(async()=>{let e=[...y.current.keys()];console.log("alreadyTypes",e);let t=l.find(t=>!e.includes(t));if(console.log("newTypes",t),t){let e=await r(t);y.current.set(t,e.pokemon.map(e=>e.pokemon))}},[l]),N=(0,o.useMemo)(()=>d.map(e=>v.current.has(e.name)?{...v.current.get(e.name)}:{...e}),[v.current.size,d]),S=(0,o.useMemo)(()=>h.total/24>h.page,[h.page,h.total]);return(0,a.jsxs)("div",{className:"flex flex-col gap-4 px-10",children:[(0,a.jsx)("p",{className:"text-center",children:"Welcome to Pokemon world"}),(0,a.jsxs)("p",{children:["Total count: ",h.total]}),(0,a.jsx)(i,{types:e,selectedTypes:l,clickType:j}),(0,a.jsxs)("section",{className:"flex flex-col justify-center",children:[(0,a.jsx)(u,{pokemons:N}),(0,a.jsxs)("div",{className:"flex justify-center gap-4 py-4",children:[0!==h.page&&(0,a.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-white",onClick:()=>{f({...h,page:h.page-1})},children:"Previous"}),S&&(0,a.jsx)("button",{className:"rounded bg-blue-500 px-4 py-2 text-white",onClick:()=>{f({...h,page:h.page+1})},children:"Next"})]})]})]})}}},e=>{e.O(0,[935,125,441,255,358],()=>e(e.s=7067)),_N_E=e.O()}]);